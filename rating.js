var gRatingOptions,gRatingButtons,gUserRating;function makeNiceRatingForm(options){gRatingOptions=options;var form=document.getElementById("rateForm");if(form){gRatingButtons=form.getElementsByTagName("input"),gUserRating="";for(var i=0;i<gRatingButtons.length;i++)if("button"==gRatingButtons[i].type){gUserRating=gRatingButtons[i].value;break}for(var i=0;i<gRatingButtons.length;i++){var rateButton=gRatingButtons[i];rateButton.initialRateValue=rateButton.value;try{rateButton.type="button"}catch(t){}with(rateButton.value=" ",rateButton.style)marginLeft=marginRight=0;i!=gRatingButtons.length-1&&3==rateButton.nextSibling.nodeType&&rateButton.parentNode.removeChild(rateButton.nextSibling),i>0&&3==rateButton.previousSibling.nodeType&&rateButton.parentNode.removeChild(rateButton.previousSibling),pwgAddEventListener(rateButton,"click",updateRating),pwgAddEventListener(rateButton,"mouseout",(function(){updateRatingStarDisplay(gUserRating)})),pwgAddEventListener(rateButton,"mouseover",(function(t){updateRatingStarDisplay(t.target?t.target.initialRateValue:t.srcElement.initialRateValue)}))}updateRatingStarDisplay(gUserRating)}}function updateRatingStarDisplay(t){for(var n=0;n<gRatingButtons.length;n++)gRatingButtons[n].className=""!==t&&t>=gRatingButtons[n].initialRateValue?"rateButtonStarFull":"rateButtonStarEmpty"}function updateRating(t){var n=t.target||t.srcElement;if(n.initialRateValue==gUserRating)return!1;for(var e=0;e<gRatingButtons.length;e++)gRatingButtons[e].disabled=!0;return new PwgWS(gRatingOptions.rootUrl).callService("pwg.images.rate",{image_id:gRatingOptions.image_id,rate:n.initialRateValue},{method:"POST",onFailure:function(t,e){alert(t+" "+e),document.location=n.form.action+"&rate="+n.initialRateValue},onSuccess:function(t){gUserRating=n.initialRateValue;for(var e=0;e<gRatingButtons.length;e++)gRatingButtons[e].disabled=!1;if(gRatingOptions.onSuccess&&gRatingOptions.onSuccess(t),gRatingOptions.updateRateElement&&(gRatingOptions.updateRateElement.innerHTML=gRatingOptions.updateRateText),gRatingOptions.ratingSummaryElement){for(var a=gRatingOptions.ratingSummaryText,i=[t.score,t.count,t.average],g=0,o=new RegExp(/%\.?\d*[sdf]/);g<i.length;)a=a.replace(o,i[g++]);gRatingOptions.ratingSummaryElement.innerHTML=a}}}),!1}!function(){if("undefined"!=typeof _pwgRatingAutoQueue&&_pwgRatingAutoQueue.length)for(var t=0;t<_pwgRatingAutoQueue.length;t++)makeNiceRatingForm(_pwgRatingAutoQueue[t]);_pwgRatingAutoQueue={push:function(t){makeNiceRatingForm(t)}}}();
